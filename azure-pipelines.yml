trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  GITHUB_TOKEN: $(Token)  # vari√°vel secreta configurada no Azure DevOps
  GITHUB_USER: NichollasLima
  GITHUB_REPO: AllThingsServeTheTower

steps:
- script: |
    git clone https://MyProjectsNRSL@dev.azure.com/MyProjectsNRSL/Atlas/_git/AllThingsServeTheTower repo
    cd repo

    git fsck --full
    git gc --prune=now --aggressive

    git config --global user.name "Azure Mirror"
    git config --global user.email "azure@mirror.dev"

    git remote add github https://$(GITHUB_USER):$(GITHUB_TOKEN)@github.com/$(GITHUB_USER)/$(GITHUB_REPO).git

    git branch
    git log -1

    git push github HEAD:refs/heads/main --force
  displayName: 'Mirror to GitHub'