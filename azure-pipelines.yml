trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  GITHUB_USER: nichollaslima
  GITHUB_REPO: AllThingsServeTheTower
  GITHUB_TOKEN: $(Token)  # 💡 isso deve vir de uma variável secreta no DevOps

steps:
- script: |
    echo "📥 Clonando repositório do Azure DevOps (este próprio repositório)..."
    git clone --bare https://$(System.AccessToken)@dev.azure.com/$(System.CollectionUri)/$(Build.Repository.Name) repo.git
    cd repo.git

    echo "📡 Adicionando GitHub como remote"
    git remote add github https://$(GITHUB_USER):$(GITHUB_TOKEN)@github.com/$(GITHUB_USER)/$(GITHUB_REPO).git

    echo "🚀 Enviando tudo para o GitHub (mirror)"
    git push --mirror github
  displayName: 'Mirror para GitHub'
  env:
    SYSTEM_ACCESSTOKEN: $(AzureDevOpsToken)
