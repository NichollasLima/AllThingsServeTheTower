trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  GITHUB_TOKEN: $(Token)  # variÃ¡vel secreta no Azure DevOps
  GITHUB_USER: NichollasLima
  GITHUB_REPO: AllThingsServeTheTower

steps:
  - checkout: self

  - script: |
      git config --global user.name "Azure Mirror"
      git config --global user.email "azure@mirror.dev"

      echo "ðŸ“¡ Remotes configurados:"
      git remote -v

      echo "âž• Adicionando GitHub como remote..."
      git remote add github https://$(GITHUB_USER):$(GITHUB_TOKEN)@github.com/$(GITHUB_USER)/$(GITHUB_REPO).git

      echo "Limpando o historico"
      git gc --prune=now
      git remote prune origin

      echo "ðŸš€ Realizando push forÃ§ado para main"
      git push github HEAD:refs/heads/main --force
    displayName: 'Mirror to GitHub'
