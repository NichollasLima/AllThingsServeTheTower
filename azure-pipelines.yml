trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  GITHUB_TOKEN: $(Token)  # Token secreto configurado no Azure DevOps
  GITHUB_USER: NichollasLima
  GITHUB_REPO: AllThingsServeTheTower

steps:
  - checkout: self
    persistCredentials: true
    fetchDepth: 0  # Importante para ter todas as refs (evita o erro)

  - script: |
      git config --global user.name "Azure Mirror"
      git config --global user.email "azure@mirror.dev"

      echo "üì° Remotes configurados:"
      git remote -v

      echo "‚ûï Adicionando GitHub como remote..."
      git remote add github https://$(GITHUB_USER):$(GITHUB_TOKEN)@github.com/$(GITHUB_USER)/$(GITHUB_REPO).git

      echo "üîç Garantindo checkout da branch main"
      git checkout main

      echo "üöÄ Realizando push for√ßado para main no GitHub..."
      git push github main --force
    displayName: 'Mirror para GitHub'
