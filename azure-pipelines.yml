trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  GITHUB_USER: nichollaslima
  GITHUB_REPO: AllThingsServeTheTower
  GITHUB_TOKEN: $(Token)  # variável secreta

steps:
- script: |
    echo "📥 Clonando repositório do Azure DevOps..."
    git config --global credential.helper store
    git clone https://$(System.AccessToken)@dev.azure.com/$(System.CollectionUri)/$(System.TeamProject)/_git/$(Build.Repository.Name) repo
    cd repo

    echo "📡 Adicionando GitHub como remote"
    git remote add github https://$(GITHUB_USER):$(GITHUB_TOKEN)@github.com/$(GITHUB_USER)/$(GITHUB_REPO).git

    echo "🚀 Fazendo push forçado da branch main para o GitHub"
    git push github main --force
  displayName: 'Mirror para GitHub'
  env:
    SYSTEM_ACCESSTOKEN: $(AzureDevOpsToken)
